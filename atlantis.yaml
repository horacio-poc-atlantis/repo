version: 3
automerge: true
abort_on_execution_order_fail: true

workflows:
  staging:
    plan:
      steps:
      - init
      - plan:
          extra_args: ["-var-file", "staging.tfvars"]
    apply:
      steps:
        - apply:
            extra_args: ["-var-file", "staging.tfvars"]

  production:
    plan:
      steps:
      - init
      - plan:
          extra_args: ["-var-file", "production.tfvars"]
    apply:
      steps:
        - apply:
            extra_args: ["-var-file", "production.tfvars"]

projects:
- name: some-application-test
  dir: some-application-test
  workflow: staging
  execution_order_group: 1
  autoplan:
    enabled: true
    when_modified:
      - "./some-application-test/*.tf"
      - "./modules/**/*.tf"
      - "./common/*.tf"

- name: some-application-prod
  dir: some-application-prod
  workflow: production
  execution_order_group: 2
  autoplan:
    enabled: true
    when_modified:
      - "./some-application-prod/*.tf"
      - "./modules/**/*.tf"
      - "./common/*.tf"
