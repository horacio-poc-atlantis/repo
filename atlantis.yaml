version: 3
automerge: true
abort_on_execution_order_fail: true

#.job_template: &job_configuration  # Hidden yaml configuration that defines an anchor named 'job_configuration'
#  image: ruby:2.6
#  services:
#    - postgres
#    - redis

.staging_template: &staging
  workflow: staging
  execution_order_group: 1
  autoplan:
    enabled: true
    when_modified:
      - "../modules/**/*.tf"
      - "../common/*.tf"
      - "*.tf"


projects:
  #- &template
  #  name: template
  #  dir: template
  #  workflow: custom
  #  autoplan:
  #    enabled: true
  #    when_modified:
  #      - "./terraform/modules/**/*.tf"
  #      - "**/*.tf"
  #      - ".terraform.lock.hcl"
  #
  #- <<: *template
  #  name: ue1-prod-titan
  #  dir: ./terraform/titan
  #  workspace: ue1-prod
  #
  #- <<: *template
  #  name: ue1-stage-titan
  #  dir: ./terraform/titan
  #  workspace: ue1-stage
  #
  #- <<: *template
  #  name: ue1-dev-titan
  #  dir: ./terraform/titan
  #  workspace: ue1-dev

#  - &staging
#    workflow: staging
#    execution_order_group: 1
#    autoplan:
#      enabled: true
#      when_modified:
#        - "../modules/**/*.tf"
#        - "../common/*.tf"
#        - "*.tf"

#  - &production
#    workflow: production
#    execution_order_group: 2
#    autoplan:
#      enabled: true
#      when_modified:
#        - "../modules/**/*.tf"
#        - "../common/*.tf"
#        - "*.tf"

  #- name: some-application-test
  #  dir: some-application
  #  workflow: staging
  #  execution_order_group: 1
  #  autoplan:
  #    enabled: true
  #    when_modified:
  #      - "../modules/**/*.tf"
  #      - "../common/*.tf"
  #      - "*.tf"

- name: some-application-test
  dir: some-application
  <<: *staging

#  - <<: *production
#    name: some-application-prod
#    dir: ./some-application

  #- name: some-application-prod
  #  dir: some-application
  #  workflow: production
  #  execution_order_group: 2
  #  autoplan:
  #    enabled: true
  #    when_modified:
  #      - "../modules/**/*.tf"
  #      - "../common/*.tf"
  #      - "*.tf"
